# ğŸ“Š DirectorScript Data Flow Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          TINGRANDOM SCRIPT SYSTEM                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  CONTROL PANEL (Director)              DISPLAY PAGE (Audience)              â”‚
â”‚  ==================                   ================                       â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ DirectorScriptSect. â”‚              â”‚  Wheel + Modal       â”‚             â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚              â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚             â”‚
â”‚  â”‚ â€¢ ThÃªm (Add)        â”‚              â”‚  â€¢ Show spinner      â”‚             â”‚
â”‚  â”‚ â€¢ Sá»­a (Edit)        â”‚              â”‚  â€¢ Display winner    â”‚             â”‚
â”‚  â”‚ â€¢ XÃ³a (Delete)      â”‚              â”‚  â€¢ Show question     â”‚             â”‚
â”‚  â”‚ â€¢ LÆ°u (Save)        â”‚              â”‚  â€¢ Play confetti     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                                        â”‚                         â”‚
â”‚         â”‚ updates                                â”‚ displays                 â”‚
â”‚         â”‚                                        â”‚                         â”‚
â”‚         â–¼                                        â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚                         â”‚
â”‚  â”‚ ControlPanel State  â”‚                        â”‚                         â”‚
â”‚  â”‚ {                   â”‚                        â”‚                         â”‚
â”‚  â”‚   script: [...]     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                         â”‚
â”‚  â”‚   currentStep: N    â”‚            â”‚           â”‚                         â”‚
â”‚  â”‚   targetId: uuid    â”‚            â”‚           â”‚                         â”‚
â”‚  â”‚ }                   â”‚            â”‚           â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚           â”‚                         â”‚
â”‚                                      â”‚           â”‚                         â”‚
â”‚                                      â–¼           â”‚                         â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚
â”‚                            â”‚ Socket.emit()    â”‚  â”‚                         â”‚
â”‚                            â”‚ control:*        â”‚  â”‚                         â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                         â”‚
â”‚                                     â”‚            â”‚                         â”‚
â”‚                                     â”‚ TCP/WS     â”‚                         â”‚
â”‚                                     â”‚            â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚            â”‚
                                      â–¼            â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   BACKEND (Node.js)      â”‚
                              â”‚   server.mjs/socket.ts   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Detailed Add/Edit/Delete Flow

### 1ï¸âƒ£ ADD NEW SCRIPT ITEM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User clicks "ThÃªm" button         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ onClick handler
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DirectorScriptSection.addScriptItem()      â”‚
â”‚                                            â”‚
â”‚ const newItem = {                          â”‚
â”‚   step: script.length + 1,                 â”‚
â”‚   contestant: '',                          â”‚
â”‚   target_judge_id: judges[0].id,          â”‚
â”‚   question_content: '',                    â”‚
â”‚   notes: ''                                â”‚
â”‚ }                                          â”‚
â”‚                                            â”‚
â”‚ onScriptChange([...script, newItem])      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ ğŸ”¹ log: "Adding new script item"
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ControlPanel.setScript(newArray)           â”‚
â”‚ Local state updates                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ ğŸ”µ log: "Script state changed"
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useEffect triggered (script dependency)    â”‚
â”‚                                            â”‚
â”‚ updateScript(script)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ ğŸ“œ log: "Update script"
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Socket.emit('control:update-script', {...})â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ to backend
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: server.mjs                        â”‚
â”‚                                            â”‚
â”‚ socket.on('control:update-script', (data))â”‚
â”‚   state.script = data.script               â”‚
â”‚   state.targetId = script[0].target_judge_id
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
         STATE STORED âœ…
     Ready to be used in spin
```

### 2ï¸âƒ£ EDIT SCRIPT ITEM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User clicks Edit (âœï¸) button      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ onClick
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ startEditing(index)                        â”‚
â”‚                                            â”‚
â”‚ setEditingIndex(index)                     â”‚
â”‚ setEditingItem({...script[index]})         â”‚
â”‚                                            â”‚
â”‚ ğŸ”¹ log: "Starting edit at index: X"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Edit Form Appears  â”‚
     â”‚  â€¢ ThÃ­ sinh input   â”‚
     â”‚  â€¢ GiÃ¡m kháº£o select â”‚
     â”‚  â€¢ CÃ¢u há»i textarea â”‚
     â”‚  â€¢ âœ“ Save button    â”‚
     â”‚  â€¢ âœ— Cancel button  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ User fills form
                  â”‚
                  â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  User clicks âœ“ (Save) button       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ saveEdit()                                     â”‚
     â”‚                                                â”‚
     â”‚ newScript[editingIndex] = editingItem          â”‚
     â”‚ onScriptChange(newScript)                      â”‚
     â”‚                                                â”‚
     â”‚ ğŸ”¹ log: "Saving edit at index: X"             â”‚
     â”‚ ğŸ”¹ log: "Updated script: [...]"               â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
     (Same as ADD flow from here - state update â†’ socket â†’ backend)
```

### 3ï¸âƒ£ DELETE SCRIPT ITEM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User clicks Delete (ğŸ—‘ï¸) button    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ onClick
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ confirm("Báº¡n cÃ³ cháº¯c...?")                â”‚
â”‚                                            â”‚
â”‚ If YES:                                    â”‚
â”‚   newScript = script.filter((_, i)=>...   â”‚
â”‚   renumbered = newScript.map((item, i)..  â”‚
â”‚   onScriptChange(renumbered)              â”‚
â”‚                                            â”‚
â”‚ ğŸ”¹ log: "Deleting item at index: X"      â”‚
â”‚ ğŸ”¹ log: "Updated script after delete"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     (Same as ADD flow - state update â†’ socket â†’ backend)
```

---

## Save to Database Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User clicks "ğŸ’¾ LÆ°u Ká»‹ch Báº£n"     â”‚
â”‚  (Save button at bottom)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ saveScript() function called      â”‚
    â”‚                                  â”‚
    â”‚ ğŸ’¾ log: "saveScript called"      â”‚
    â”‚ ğŸ’¾ log: "Current script: [...]"  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ API Call: PUT /api/campaigns/{id}â”‚
    â”‚                                  â”‚
    â”‚ Header:                          â”‚
    â”‚   Authorization: Bearer {token}  â”‚
    â”‚                                  â”‚
    â”‚ Body: {                          â”‚
    â”‚   director_script: [...]         â”‚
    â”‚ }                                â”‚
    â”‚                                  â”‚
    â”‚ ğŸ’¾ log: "Sending payload to API" â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ HTTPS PUT
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Backend API Response             â”‚
    â”‚                                  â”‚
    â”‚ {                                â”‚
    â”‚   success: true,                 â”‚
    â”‚   campaign: {                    â”‚
    â”‚     director_script: [...]       â”‚
    â”‚   }                              â”‚
    â”‚ }                                â”‚
    â”‚                                  â”‚
    â”‚ ğŸ’¾ log: "API response: {...}"   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ if (response.ok)                 â”‚
    â”‚   Show âœ… Green Message          â”‚
    â”‚   "LÆ°u ká»‹ch báº£n thÃ nh cÃ´ng!"     â”‚
    â”‚                                  â”‚
    â”‚ ğŸ’¾ log: "Script saved successfully"
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
       DATABASE âœ… PERSISTED
    Script saved in MongoDB
```

---

## Spin & Display Question Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Control Panel: Select mode       â”‚
â”‚ â€¢ Manual: Quay + Dá»«ng            â”‚
â”‚ â€¢ Script: Tiáº¿p Theo (auto)      â”‚
â”‚ â€¢ Auto: Quay liÃªn tá»¥c            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€ Script Mode Selected
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ triggerSpin() or triggerNext()              â”‚
â”‚                                              â”‚
â”‚ const currentScript = state.script[step]     â”‚
â”‚                                              â”‚
â”‚ scriptInfo = {                               â”‚
â”‚   step: currentScript.step,                  â”‚
â”‚   contestant: currentScript.contestant,      â”‚
â”‚   question: currentScript.question_content   â”‚
â”‚ }                                            â”‚
â”‚                                              â”‚
â”‚ socket.emit('control:spin', {                â”‚
â”‚   campaignId,                                â”‚
â”‚   spinDuration: 5,                           â”‚
â”‚   targetId: state.targetId,                  â”‚
â”‚   scriptInfo: {...}                          â”‚
â”‚ })                                           â”‚
â”‚                                              â”‚
â”‚ ğŸ² log: "Triggering spin"                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ via Socket.IO
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: socket.on('control:spin')           â”‚
â”‚                                              â”‚
â”‚ session.status = 'spinning'                  â”‚
â”‚ session.scriptInfo = scriptInfo              â”‚
â”‚                                              â”‚
â”‚ Broadcast to all clients:                    â”‚
â”‚ io.to(campaignId).emit('state:update', {     â”‚
â”‚   status: 'spinning',                        â”‚
â”‚   spinDuration: 5,                           â”‚
â”‚   scriptInfo: {...}                          â”‚
â”‚ })                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Broadcast to both pages
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚
    â–¼                 â–¼
CONTROL PAGE     DISPLAY PAGE
(updates)        (receives)
                 â”‚
                 â”‚ socket.on('state:update')
                 â”‚ ğŸ° log: "Received state update"
                 â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ if (data.scriptInfo)    â”‚
            â”‚   setScriptInfo(...)    â”‚
            â”‚                         â”‚
            â”‚ ğŸ° log: "Received      â”‚
            â”‚     scriptInfo: {...}"  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Wait 5 seconds (spin duration)
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Wheel stops on Judge    â”‚
            â”‚ handleSpinComplete()    â”‚
            â”‚                         â”‚
            â”‚ const winner = {        â”‚
            â”‚   name: judge.name,     â”‚
            â”‚   contestant:           â”‚
            â”‚     scriptInfo?.         â”‚
            â”‚     contestant,          â”‚
            â”‚   question:             â”‚
            â”‚     scriptInfo?.         â”‚
            â”‚     question            â”‚
            â”‚ }                       â”‚
            â”‚                         â”‚
            â”‚ ğŸ‰ log: "Final winner: â”‚
            â”‚   {...}"                â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Show Winner Modal                â”‚
            â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”    â”‚
            â”‚ ğŸ† Judge Name (winner)          â”‚
            â”‚ ğŸ‘¤ Contestant: [script.name]    â”‚
            â”‚ â“ Question: [script.question]  â”‚
            â”‚ ğŸ‰ Confetti animation          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                   DISPLAY âœ…
              Question shown to audience
```

---

## Field Name Mapping

### DirectorScript Model (Database)
```javascript
{
  step: number,              // Sequential number 1,2,3...
  contestant: string,        // "Nguyá»…n VÄƒn A"
  target_judge_id: string,  // UUID of judge
  question_content: string,  // "HÃ£y giá»›i thiá»‡u báº£n thÃ¢n?"
  notes: string             // Optional notes
}
```

### ScriptInfo (Socket Transfer)
```javascript
{
  step: number,              // Same as above
  contestant: string,        // Same as above
  question: string          // âš ï¸ MAPPED from question_content!
}
```

### Winner Modal (Display)
```javascript
{
  id: string,
  name: string,              // Judge name
  contestant: string,        // From scriptInfo.contestant
  question: string,          // From scriptInfo.question
  color: string,
  timestamp: number,
  imageUrl: string
}
```

**ğŸ”´ KEY:** `question_content` in DirectorScript becomes `question` in ScriptInfo!

---

## File Locations

```
Frontend:
  components/
    â”œâ”€ ControlPanel/
    â”‚  â”œâ”€ ControlPanel.tsx              (state management)
    â”‚  â”œâ”€ sections/
    â”‚  â”‚  â”œâ”€ DirectorScriptSection.tsx  (CRUD UI)
    â”‚  â”‚  â””â”€ LiveControlSection.tsx     (spin controls)
    â”‚  â””â”€ hooks/
    â”‚     â””â”€ useSocket.ts               (socket events)
    â”‚
    â””â”€ Wheel/
       â””â”€ Wheel.tsx                      (wheel animation)

Backend:
  app/
    â”œâ”€ api/
    â”‚  â””â”€ campaigns/
    â”‚     â”œâ”€ route.ts                   (API endpoints)
    â”‚     â””â”€ [id]/
    â”‚        â””â”€ route.ts                (campaign detail)
    â”‚
    â””â”€ display/
       â””â”€ guest/
          â””â”€ page.tsx                   (display page)

Socket Handlers:
  â”œâ”€ server.mjs                          (alternate implementation)
  â””â”€ lib/
     â””â”€ socket.ts                        (primary handlers)
```

---

## Logging Legend

```
ğŸ”¹ DirectorScriptSection  - Add/Edit/Delete button interactions
ğŸ”µ ControlPanel           - State updates and synchronization
ğŸ’¾ SaveScript             - Database persistence
ğŸ“œ Socket                 - Real-time communication
ğŸ° Display                - Wheel spin results and display
```

---

**Use this diagram to understand the complete flow!**
